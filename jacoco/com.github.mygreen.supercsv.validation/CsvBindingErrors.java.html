<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CsvBindingErrors.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Super CSV Annotation</a> &gt; <a href="index.source.html" class="el_package">com.github.mygreen.supercsv.validation</a> &gt; <span class="el_source">CsvBindingErrors.java</span></div><h1>CsvBindingErrors.java</h1><pre class="source lang-java linenums">package com.github.mygreen.supercsv.validation;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.Objects;

import com.github.mygreen.supercsv.util.ArgUtils;
import com.github.mygreen.supercsv.util.Utils;

/**
 * CSVのエラー情報を管理するためのクラス。
 * &lt;p&gt;SpringFrameworkのBindingResultを参考。&lt;/p&gt;
 * &lt;p&gt;現状、ネストしたフィールドはサポートしていないため、パスの機能を省略して実装する。&lt;/p&gt;
 *
 * @version 2.2
 * @since 2.0
 * @author T.TSUCHIE
 *
 */
public class CsvBindingErrors implements Serializable {
    
    /** serialVersionUID */
    private static final long serialVersionUID = -9014484172903397334L;
    
    /** パスの区切り文字 */
    public static final String PATH_SEPARATOR = &quot;.&quot;;
    
    /** オブジェクト名 */
    private final String objectName;
    
    /** エラーオブジェクト */
<span class="fc" id="L36">    private final List&lt;CsvError&gt; errors = new ArrayList&lt;&gt;();</span>
    
    /** エラーコードの候補を生成するクラス */
<span class="fc" id="L39">    private MessageCodeGenerator messageCodeGenerator = new MessageCodeGenerator();</span>
    
    /**
     * オブジェクト名を指定するコンストラクタ。
     * @param objectName メッセージオブジェクトを構成する際に、自動的に付与する名称。
     * @throws NullPointerException {@link objectName is null.}
     */
<span class="fc" id="L46">    public CsvBindingErrors(final String objectName) {</span>
<span class="fc" id="L47">        Objects.requireNonNull(objectName);</span>
<span class="fc" id="L48">        this.objectName = objectName;</span>
<span class="fc" id="L49">    }</span>
    
    /**
     * クラス名を元にオブジェクト名を設定するコンストラクタ。
     * @param clazz 検証対象のBeanのクラスタイプ。
     */
    public CsvBindingErrors(final Class&lt;?&gt; clazz) {
<span class="fc" id="L56">        this(clazz.getSimpleName());</span>
<span class="fc" id="L57">    }</span>
    
    /**
     * オブジェクト名の取得
     * @return コンストラクタで設定したオブジェクト名を取得する。
     */
    public String getObjectName() {
<span class="fc" id="L64">        return objectName;</span>
    }
    
    /**
     * 全てのエラー情報を取得する。
     * @return 現在のエラー情報
     */
    public List&lt;CsvError&gt; getAllErrors() {
<span class="fc" id="L72">        return new ArrayList&lt;&gt;(errors);</span>
    }
    
    /**
     * エラーを追加する
     * @param error
     */
    public void addError(final CsvError error) {
<span class="fc" id="L80">        this.errors.add(error);</span>
<span class="fc" id="L81">    }</span>
    
    /**
     * 全てのエラー情報を追加する。
     * @param errors 追加するエラー情報。
     */
    public void addAllErrors(Collection&lt;CsvError&gt; errors) {
<span class="fc" id="L88">        this.errors.addAll(errors);</span>
<span class="fc" id="L89">    }</span>
    
    /**
     * 全てのエラー情報を削除する。
     */
    public void clearAllErrors() {
<span class="nc" id="L95">        this.errors.clear();</span>
<span class="nc" id="L96">    }</span>
    
    /**
     * エラー情報が存在するかどうか確かめる。
     * @return trueの場合、エラー情報が存在する。
     */
    public boolean hasErrors() {
<span class="fc bfc" id="L103" title="All 2 branches covered.">        return !errors.isEmpty();</span>
    }
    
    /**
     * グローバルエラーを取得する
     * @return エラーがない場合は空のリストを返す
     */
    public List&lt;CsvError&gt; getGlobalErrors() {
<span class="nc" id="L111">        final List&lt;CsvError&gt; list = new ArrayList&lt;CsvError&gt;();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">        for(CsvError item : this.errors) {</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">            if(!(item instanceof CsvFieldError)) {</span>
<span class="nc" id="L114">                list.add(item);</span>
            }
<span class="nc" id="L116">        }</span>
        
<span class="nc" id="L118">        return list;</span>
    }
    
    /**
     * 先頭のグローバルエラーを取得する。
     * @return 存在しない場合は、nullを返す。
     */
    public CsvError getFirstGlobalError() {
<span class="nc bnc" id="L126" title="All 2 branches missed.">        for(CsvError item : this.errors) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">            if(!(item instanceof CsvFieldError)) {</span>
<span class="nc" id="L128">                return item;</span>
            }
<span class="nc" id="L130">        }</span>
        
<span class="nc" id="L132">        return null;</span>
    }
    
    /**
     * グローバルエラーがあるか確かめる。
     * @return
     */
    public boolean hasGlobalErrors() {
<span class="nc bnc" id="L140" title="All 2 branches missed.">        return !getGlobalErrors().isEmpty();</span>
    }
    
    /**
     * グローバルエラーの件数を取得する
     * @return
     */
    public int getGlobalErrorCount() {
<span class="nc" id="L148">        return getGlobalErrors().size();</span>
    }
    
    /**
     * フィールドエラーを取得する
     * @return エラーがない場合は空のリストを返す
     */
    public List&lt;CsvFieldError&gt; getFieldErrors() {
<span class="nc" id="L156">        final List&lt;CsvFieldError&gt; list = new ArrayList&lt;CsvFieldError&gt;();</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        for(CsvError item : this.errors) {</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">            if(item instanceof CsvFieldError) {</span>
<span class="nc" id="L159">                list.add((CsvFieldError) item);</span>
            }
<span class="nc" id="L161">        }</span>
        
<span class="nc" id="L163">        return list;</span>
    }
    
    /**
     * 先頭のフィールドエラーを取得する
     * @return エラーがない場合は空のリストを返す
     */
    public CsvFieldError getFirstFieldError() {
<span class="nc bnc" id="L171" title="All 2 branches missed.">        for(CsvError item : this.errors) {</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if(item instanceof CsvFieldError) {</span>
<span class="nc" id="L173">                return (CsvFieldError) item;</span>
            }
<span class="nc" id="L175">        }</span>
        
<span class="nc" id="L177">        return null;</span>
    }
    
    /**
     * フィールドエラーが存在するか確かめる。
     * @return true:フィールドエラーを持つ。
     */
    public boolean hasFieldErrors() {
<span class="nc bnc" id="L185" title="All 2 branches missed.">        return !getFieldErrors().isEmpty();</span>
    }
    
    /**
     * フィールドエラーの件数を取得する。
     * @return
     */
    public int getFieldErrorCount() {
<span class="nc" id="L193">        return getFieldErrors().size();</span>
    }
    
    /**
     * パスを指定してフィールドエラーを取得する
     * @param path 最後に'*'を付けるとワイルドカードが指定可能。
     * @return
     * @throws IllegalArgumentException {@literal if path is empty.}
     */
    public List&lt;CsvFieldError&gt; getFieldErrors(final String path) {
<span class="fc" id="L203">        ArgUtils.notEmpty(path, &quot;path&quot;);</span>
        
<span class="fc" id="L205">        final List&lt;CsvFieldError&gt; list = new ArrayList&lt;CsvFieldError&gt;();</span>
<span class="fc bfc" id="L206" title="All 2 branches covered.">        for(CsvError item : this.errors) {</span>
<span class="pc bpc" id="L207" title="1 of 4 branches missed.">            if(item instanceof CsvFieldError &amp;&amp; isMatchingFieldError(path, (CsvFieldError) item)) {</span>
<span class="fc" id="L208">                list.add((CsvFieldError) item);</span>
            }
<span class="fc" id="L210">        }</span>
        
<span class="fc" id="L212">        return list;</span>
    }
    
    /**
     * パスを指定して先頭のフィールドエラーを取得する
     * @param path 最後に'*'を付けるとワイルドカードが指定可能。
     * @return エラーがない場合は空のリストを返す
     */
    public CsvFieldError getFirstFieldError(final String path) {
<span class="fc" id="L221">        ArgUtils.notEmpty(path, &quot;path&quot;);</span>
        
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">        for(CsvError item : this.errors) {</span>
<span class="nc bnc" id="L224" title="All 4 branches missed.">            if(item instanceof CsvFieldError &amp;&amp; isMatchingFieldError(path, (CsvFieldError) item)) {</span>
<span class="nc" id="L225">                return (CsvFieldError) item;</span>
            }
<span class="nc" id="L227">        }</span>
        
<span class="fc" id="L229">        return null;</span>
    }
    
    /**
     * 指定したパスのフィィールドエラーが存在するか確かめる。
     * @param path 最後に'*'を付けるとワイルドカードが指定可能。
     * @return true:エラーがある場合。
     */
    public boolean hasFieldErrors(final String path) {
<span class="fc bfc" id="L238" title="All 2 branches covered.">        return !getFieldErrors(path).isEmpty();</span>
    }
    
    /**
     * 指定したパスのフィィールドエラーの件数を取得する。
     * @param path 最後に'*'を付けるとワイルドカードが指定可能。
     * @return
     */
    public int getFieldErrorCount(final String path) {
<span class="nc" id="L247">        return getFieldErrors(path).size();</span>
    }
    
    /**
     * 指定したパスがフィールドエラーのパスと一致するかチェックするかどうか。
     * @param path 
     * @param fieldError
     * @return true: 一致する場合。
     */
    private boolean isMatchingFieldError(final String path, final CsvFieldError fieldError) {
        
<span class="fc bfc" id="L258" title="All 2 branches covered.">        if (fieldError.getField().equals(path)) {</span>
<span class="fc" id="L259">            return true;</span>
        }
        
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">        if(path.endsWith(&quot;*&quot;)) {</span>
<span class="nc" id="L263">            String subPath = path.substring(0, path.length()-1);</span>
<span class="nc" id="L264">            return fieldError.getField().startsWith(subPath);</span>
        }
        
<span class="fc" id="L267">        return false;</span>
    }
    
    /**
     * グローバルエラーを登録する。
     * @param errorCode エラーコード
     */
    public void reject(final String errorCode) {
<span class="nc" id="L275">        reject(errorCode, Collections.emptyMap(), null);</span>
<span class="nc" id="L276">    }</span>
    
    /**
     * グローバルエラーを登録する。
     * @param errorCode エラーコード
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void reject(final String errorCode, final String defaultMessage) {
<span class="nc" id="L284">        reject(errorCode, Collections.emptyMap(), defaultMessage);</span>
<span class="nc" id="L285">    }</span>
    
    /**
     * グローバルエラーを登録する。
     * @param errorCode エラーコード
     * @param messageVariables メッセージ中の変数。
     */
    public void reject(final String errorCode, final Map&lt;String, Object&gt; messageVariables) {
<span class="nc" id="L293">        reject(errorCode, messageVariables, null);</span>
<span class="nc" id="L294">    }</span>
    
    /**
     * グローバルエラーを登録する。
     * @param errorCode エラーコード
     * @param messageVariables メッセージ中の変数。
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void reject(final String errorCode, final Map&lt;String, Object&gt; messageVariables, final String defaultMessage) {
<span class="nc" id="L303">        reject(new String[]{errorCode}, messageVariables, defaultMessage);</span>
<span class="nc" id="L304">    }</span>
    
    /**
     * グローバルエラーを登録する。
     * @since 2.2
     * @param errorCodes エラーコード
     * @param messageVariables メッセージ中の変数。
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void reject(final String[] errorCodes, final Map&lt;String, Object&gt; messageVariables, final String defaultMessage) {
        
<span class="fc" id="L315">        String[] codes = new String[0];</span>
<span class="pc bpc" id="L316" title="1 of 2 branches missed.">        for(String errorCode : errorCodes) {</span>
<span class="nc" id="L317">            codes = Utils.concat(codes, messageCodeGenerator.generateCodes(errorCode, getObjectName()));</span>
        }
<span class="fc" id="L319">        addError(new CsvError(getObjectName(), codes, messageVariables, defaultMessage));</span>
<span class="fc" id="L320">    }</span>
    
    /**
     * フィールドエラーを登録します。
     * @param field フィールドパス。
     * @param errorCode エラーコード。
     */
    public void rejectValue(final String field, final String errorCode) {
<span class="nc" id="L328">        rejectValue(field, null, errorCode, Collections.emptyMap(), null);</span>
        
<span class="nc" id="L330">    }</span>
    
    /**
     * フィールドエラーを登録します。
     * @param field フィールドパス。
     * @param errorCode エラーコード。
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void rejectValue(final String field, final String errorCode, final String defaultMessage) {
<span class="nc" id="L339">        rejectValue(field, null, errorCode, Collections.emptyMap(), defaultMessage);</span>
        
<span class="nc" id="L341">    }</span>
    
    /**
     * フィールドエラーを登録します。
     * @param field フィールドパス。
     * @param errorCode エラーコード。
     * @param messageVariables メッセージ中の変数。
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void rejectValue(final String field, final String errorCode, 
            final Map&lt;String, Object&gt; messageVariables, final String defaultMessage) {
        
<span class="nc" id="L353">        rejectValue(field, null, errorCode, Collections.emptyMap(), defaultMessage);</span>
        
<span class="nc" id="L355">    }</span>
    
    /**
     * フィールドエラーを登録します。
     * @param field フィールドパス。
     * @param fieldType フィールドのタイプ
     * @param errorCode エラーコード。
     * @param messageVariables メッセージ中の変数。
     */
    public void rejectValue(final String field, final Class&lt;?&gt; fieldType, final String errorCode, 
            final Map&lt;String, Object&gt; messageVariables) {
        
<span class="fc" id="L367">        rejectValue(field, fieldType, errorCode, messageVariables, null);</span>
        
<span class="fc" id="L369">    }</span>
    
    /**
     * フィールドエラーを登録します。
     * @param field フィールドパス。
     * @param fieldType フィールドのタイプ
     * @param errorCode エラーコード。
     * @param messageVariables メッセージ中の変数。
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void rejectValue(final String field, final Class&lt;?&gt; fieldType, final String errorCode, 
            final Map&lt;String, Object&gt; messageVariables, final String defaultMessage) {
        
<span class="fc" id="L382">        rejectValue(field, fieldType, new String[]{errorCode}, messageVariables, defaultMessage);</span>
<span class="fc" id="L383">    }</span>
    
    /**
     * フィールドエラーを登録します。
     * @since 2.2
     * @param field フィールドパス。
     * @param fieldType フィールドのタイプ
     * @param errorCodes エラーコード。
     * @param messageVariables メッセージ中の変数。
     * @param defaultMessage 指定したエラーコードに対するメッセージが見つからないときに使用するメッセージです。指定しない場合はnullを設定します。
     */
    public void rejectValue(final String field, final Class&lt;?&gt; fieldType, final String[] errorCodes, 
            final Map&lt;String, Object&gt; messageVariables, final String defaultMessage) {
        
<span class="fc" id="L397">        String[] codes = new String[0];</span>
<span class="fc bfc" id="L398" title="All 2 branches covered.">        for(String errorCode : errorCodes) {</span>
<span class="fc" id="L399">            codes = Utils.concat(codes, messageCodeGenerator.generateCodes(errorCode, getObjectName(), field, fieldType));</span>
        }
        
<span class="fc" id="L402">        addError(new CsvFieldError(getObjectName(), field, false, codes, messageVariables, defaultMessage));</span>
        
<span class="fc" id="L404">    }</span>
    
    public MessageCodeGenerator getMessageCodeGenerator() {
<span class="nc" id="L407">        return messageCodeGenerator;</span>
    }
    
    public void setMessageCodeGenerator(MessageCodeGenerator messageCodeGenerator) {
<span class="nc" id="L411">        this.messageCodeGenerator = messageCodeGenerator;</span>
<span class="nc" id="L412">    }</span>
    
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>